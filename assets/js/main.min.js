function initializeMobileMenu(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu-close-button"),n=document.getElementById("mobile-menu-overlay");if(!e||!t||!n)return;const o=n.querySelectorAll("a[href], button"),i=o[0],a=o[o.length-1],s=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===i&&(a.focus(),e.preventDefault()):document.activeElement===a&&(i.focus(),e.preventDefault()))},r=()=>{n.classList.add("hidden"),n.setAttribute("aria-hidden","true"),document.body.style.overflow="",e.focus(),document.removeEventListener("keydown",s)};e.addEventListener("click",()=>{n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",t.focus(),document.addEventListener("keydown",s)}),t.addEventListener("click",r),n.querySelectorAll(".nav-link-mobile").forEach(e=>{e.addEventListener("click",r)}),document.addEventListener("keydown",e=>{"Escape"!==e.key||n.classList.contains("hidden")||r()})}function initializeDarkMode(){const e=document.getElementById("dark-mode-toggle");if(!e)return;const t=document.getElementById("sun-icon"),n=document.getElementById("moon-icon"),o=e=>{"dark"===e?(document.documentElement.classList.add("dark"),t.classList.add("hidden"),n.classList.remove("hidden")):(document.documentElement.classList.remove("dark"),t.classList.remove("hidden"),n.classList.add("hidden"))},i=localStorage.getItem("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;o(i||(a?"dark":"light")),e.addEventListener("click",()=>{const e=document.documentElement.classList.contains("dark")?"light":"dark";localStorage.setItem("theme",e),o(e)})}function setupSkipLink(){const e=document.querySelector('a[href="#main-content"]'),t=document.getElementById("main-content");e&&t&&e.addEventListener("click",t=>{t.preventDefault();const n=document.getElementById(e.hash.substring(1));n&&(n.setAttribute("tabindex","-1"),n.focus({preventScroll:!0}),n.scrollIntoView({behavior:"smooth"}),n.addEventListener("blur",()=>{n.removeAttribute("tabindex")},{once:!0}))})}function setupPhoneObfuscation(e,t,n=""){const o=document.getElementById(e),i=document.getElementById(t);if(!o||!i)return;const a=atob("KzM0IDYzNSA5NDUgNzc5");o.addEventListener("click",function e(t){t.preventDefault(),i.textContent=`${n}${a}`.trim(),o.href=`tel:${a.replace(/\s/g,"")}`,o.removeEventListener("click",e)})}function setupBackToTopButton(){const e=document.getElementById("back-to-top");if(!e)return;let t,n=!1;window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>{const t=window.scrollY>300;t!==n&&(e.style.opacity=t?"1":"0",e.style.transform=t?"scale(1)":"scale(0.9)",e.setAttribute("aria-hidden",String(!t)),n=t)},100)},{passive:!0}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}function setupScrollAnimations(){const e=document.querySelectorAll(".animate-on-scroll");if(!e.length)return;const t=new IntersectionObserver((e,t)=>{e.forEach((e,n)=>{e.isIntersecting&&(setTimeout(()=>{e.target.classList.add("is-visible")},100*n),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{t.observe(e)})}function setupFormValidation(){const e=document.getElementById("contact-form");if(!e)return;const t=e.querySelectorAll("input[required], textarea[required]"),n=e.querySelector('button[type="submit"]'),o=document.getElementById("form-general-error"),i=n.querySelector(".button-text"),a=n.querySelector(".button-spinner"),s=(e,t)=>{const n=document.getElementById(`${e.id}-error`);n&&(n.textContent=t,n.classList.add("form-error-active")),e.setAttribute("aria-invalid","true"),e.classList.add("input-error")},r=e=>{const t=document.getElementById(`${e.id}-error`);t&&(t.textContent="",t.classList.remove("form-error-active")),e.setAttribute("aria-invalid","false"),e.classList.remove("input-error")},d=e=>e.validity.valueMissing?(s(e,"Este campo es obligatorio."),!1):e.validity.typeMismatch&&"email"===e.type?(s(e,"Por favor, introduce una dirección de correo válida."),!1):(r(e),!0),c=document.getElementById("contact-form-wrapper"),l=document.getElementById("form-success-message"),u=document.getElementById("message"),m=document.getElementById("char-counter");if(u&&m){const t=parseInt(u.getAttribute("maxlength"),10),n=()=>{const e=u.value.length;m.textContent=`${e} / ${t}`,m.classList.remove("text-slate-500","text-orange-600","text-red-600","font-bold"),e>t?m.classList.add("text-red-600","font-bold"):e>.9*t?m.classList.add("text-orange-600"):m.classList.add("text-slate-500")};u.addEventListener("input",n),e.addEventListener("reset",()=>setTimeout(n,0))}e.addEventListener("submit",async s=>{s.preventDefault(),n.disabled=!0,i&&i.classList.add("hidden"),a&&a.classList.remove("hidden"),o&&(o.textContent="");let r=!0;for(const e of t)if(!d(e)){r=!1,e.focus();break}if(!r)return console.log("Formulario no válido. No se enviará."),n.disabled=!1,i&&i.classList.remove("hidden"),void(a&&a.classList.add("hidden"));try{const t=new FormData(e),n=await fetch("https://formsubmit.co/ajax/contacto@pedroubedasanchez.es",{method:"POST",headers:{Accept:"application/json"},body:t}),o=await n.json();if("true"!==o.success&&!0!==o.success)throw new Error(o.message||"Hubo un problema con la validación del formulario.");c.classList.add("hidden"),l.classList.remove("hidden"),l.focus()}catch(e){console.error("Error en el envío del formulario:",e),o&&(o.textContent="Error: "+e.message+" Por favor, inténtalo de nuevo más tarde."),l.classList.contains("hidden")&&(n.disabled=!1,i&&i.classList.remove("hidden"),a&&a.classList.add("hidden"))}}),t.forEach(e=>{e.addEventListener("blur",e=>d(e.target)),e.addEventListener("input",e=>{"true"===e.target.getAttribute("aria-invalid")&&d(e.target)})});const v=document.getElementById("form-reset-button");v&&v.addEventListener("click",()=>{l.classList.add("hidden"),e.reset(),c.classList.remove("hidden"),t.forEach(r),o&&(o.textContent=""),n.disabled=!1})}function setActiveNavLink(){const e=window.location.pathname;document.querySelectorAll("a.nav-link, a.nav-link-mobile").forEach(t=>{new URL(t.href).pathname===e?t.setAttribute("aria-current","page"):t.removeAttribute("aria-current")})}!function(){const e=window.location;if(e.search){const t={};if(e.search.slice(1).split("&").forEach(e=>{const n=e.split("=");t[n[0]]=decodeURIComponent(n[1]).replace(/~and~/g,"&")}),t.p){const n=e.pathname.replace(/\/$/,"")+t.p;window.history.replaceState(null,null,n+(t.q?"?"+t.q:"")+e.hash)}}}();const pageCache=new Map;let initialContent=null,currentNavIndex=0;function setupDirectPrint(){const e=document.getElementById("print-cv-button");e&&(e.setAttribute("href","/curriculum.html"),e.setAttribute("role","button"),e.addEventListener("click",e=>{e.preventDefault();let t=document.getElementById("print-iframe-cv");t?(t.contentWindow.focus(),t.contentWindow.print()):(t=document.createElement("iframe"),t.id="print-iframe-cv",t.src="/curriculum.html",t.style.display="none",document.body.appendChild(t),t.onload=()=>{t.contentWindow.focus(),t.contentWindow.print()})}))}async function loadComponent(e,t){try{const n=await fetch(t);if(!n.ok)throw new Error(`Error al cargar ${t}: ${n.statusText}`);const o=await n.text(),i=document.querySelector(e);i&&(i.innerHTML=o)}catch(e){console.error(`No se pudo cargar el componente desde ${t}:`,e)}finally{return Promise.resolve()}}function updateMetaTag(e,t,n,o=!1){if("string"!=typeof n||""===n.trim())return;let i=document.querySelector(e);i||(i=document.createElement(o?"link":"meta"),e.match(/\[(.*?)\]/g).forEach(e=>{const[t,n]=e.slice(1,-1).split("=");i.setAttribute(t,n.replace(/"/g,""))}),document.head.appendChild(i)),i.setAttribute(t,n)}function displayError(e,t,n){e.innerHTML=`\n        <section class="text-center bg-white py-16 px-4 sm:px-8 rounded-lg shadow-lg">\n            <h1 class="text-3xl sm:text-4xl font-bold mb-4 text-red-600">${t}</h1>\n            <p class="text-slate-600 mb-8 max-w-lg mx-auto">${n}</p>\n            <a class="inline-block bg-orange-700 text-white font-bold py-3 px-6 rounded-lg hover:bg-orange-800 transition-colors duration-300 shadow-lg" href="/">\n                Volver a la página principal\n            </a>\n        </section>\n    `}const SKELETONS={default:'\n        <section class="mb-24" aria-live="polite" aria-busy="true">\n            <div class="h-10 w-3/5 mx-auto mb-12 skeleton"></div>\n            <div class="relative max-w-4xl mx-auto space-y-8">\n                <div class="bg-white p-6 rounded-lg shadow-lg border-l-4 border-gray-200">\n                    <div class="h-6 w-3/5 mb-2 skeleton"></div>\n                    <div class="h-4 w-1/3 mb-4 skeleton"></div>\n                    <div class="space-y-3"><div class="h-4 w-full skeleton"></div><div class="h-4 w-5/6 skeleton"></div></div>\n                </div>\n                <div class="bg-white p-6 rounded-lg shadow-lg border-l-4 border-gray-200">\n                    <div class="h-6 w-1/2 mb-2 skeleton"></div>\n                    <div class="h-4 w-1/4 mb-4 skeleton"></div>\n                    <div class="space-y-3"><div class="h-4 w-full skeleton"></div></div>\n                </div>\n            </div>\n        </section>\n    ',twoColumns:'\n        <section class="mb-24" aria-live="polite" aria-busy="true">\n            <div class="h-10 w-2/5 mx-auto mb-12 skeleton"></div>\n            <div class="grid md:grid-cols-2 gap-8 md:gap-12 max-w-6xl mx-auto">\n                <div class="bg-white p-6 rounded-lg shadow-lg">\n                    <div class="h-7 w-3/4 mb-6 skeleton"></div>\n                    <div class="space-y-4"><div class="h-5 w-full skeleton"></div><div class="h-5 w-5/6 skeleton"></div><div class="h-5 w-full skeleton"></div></div>\n                </div>\n                <div class="bg-white p-6 rounded-lg shadow-lg">\n                    <div class="h-7 w-3/4 mb-6 skeleton"></div>\n                    <div class="space-y-4"><div class="h-5 w-full skeleton"></div><div class="h-5 w-5/6 skeleton"></div></div>\n                </div>\n            </div>\n        </section>\n    ',threeColumns:'\n        <section class="mb-24" aria-live="polite" aria-busy="true">\n            <div class="h-10 w-1/3 mx-auto mb-12 skeleton"></div>\n            <div class="grid md:grid-cols-3 gap-8 md:gap-12 max-w-5xl mx-auto">\n                <div class="bg-white p-6 rounded-lg shadow-lg"><div class="h-7 w-3/4 mx-auto mb-4 skeleton"></div><div class="space-y-4"><div class="h-5 w-full skeleton"></div><div class="h-5 w-5/6 skeleton"></div></div></div>\n                <div class="bg-white p-6 rounded-lg shadow-lg"><div class="h-7 w-3/4 mx-auto mb-4 skeleton"></div><div class="space-y-4"><div class="h-5 w-full skeleton"></div></div></div>\n                <div class="bg-white p-6 rounded-lg shadow-lg"><div class="h-7 w-3/4 mx-auto mb-4 skeleton"></div><div class="space-y-4"><div class="h-5 w-full skeleton"></div><div class="h-5 w-5/6 skeleton"></div></div></div>\n            </div>\n        </section>\n    ',contact:'\n        <section class="py-12 sm:py-16 md:py-20" aria-live="polite" aria-busy="true">\n            <div class="container mx-auto px-4 sm:px-6 lg:px-8">\n                <div class="max-w-3xl mx-auto">\n                    <div class="h-10 w-1/3 mx-auto mb-4 skeleton"></div>\n                    <div class="h-6 w-3/4 mx-auto mb-8 skeleton"></div>\n                    <div class="bg-white p-8 rounded-lg shadow-lg">\n                        <div class="flex flex-col sm:flex-row sm:justify-between gap-8 mb-8">\n                            <div class="h-12 w-1/4 skeleton"></div>\n                            <div class="h-12 w-1/4 skeleton"></div>\n                            <div class="h-12 w-1/4 skeleton"></div>\n                        </div>\n                        <div class="max-w-xl mx-auto">\n                            <div class="mb-4"><div class="h-6 w-1/4 mb-2 skeleton"></div><div class="h-10 w-full skeleton"></div></div>\n                            <div class="mb-4"><div class="h-6 w-1/3 mb-2 skeleton"></div><div class="h-10 w-full skeleton"></div></div>\n                            <div class="mb-6"><div class="h-6 w-1/4 mb-2 skeleton"></div><div class="h-24 w-full skeleton"></div></div>\n                            <div class="text-center"><div class="h-12 w-48 mx-auto skeleton"></div></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n    '},MAIN_CONTENT_SELECTOR="#main-content",getPageId=e=>"/"===e||"/index.html"===e||""===e?"sobre-mi":e.substring(1).replace(/\.html$/,"");async function loadPageContent(e){const t=async()=>{const t=getPageId(e),n=document.querySelector("#main-content");"sobre-mi"===t?renderHomePage(n):pageCache.has(t)?renderFromCache(t,n):await fetchAndRenderPage(t,n),postNavigationTasks(e,t,n)},n=getNavIndexForPath(e)>currentNavIndex?"forward":"backward";if(document.startViewTransition){document.documentElement.classList.add("forward"===n?"slide-forward":"slide-backward");document.startViewTransition(t).finished.then(()=>{document.documentElement.classList.remove("slide-forward","slide-backward")})}else await t()}function renderHomePage(e){e.innerHTML=initialContent;updateAllMetaTags({title:"Pedro Úbeda Sánchez | Técnico en Informática, Aviónica y Administración",description:"Sitio web profesional de Pedro Úbeda Sánchez, técnico especialista con más de 20 años de experiencia en informática, aviónica y administración. Descubre mi trayectoria y habilidades.",canonical:"https://pedroubedasanchez.es/",og:{title:"Pedro Úbeda Sánchez | Técnico Especialista",description:"Técnico con más de 20 años de experiencia en informática, aviónica y administración.",url:"https://pedroubedasanchez.es/"}}),announcePageLoad("Sobre mí")}function renderFromCache(e,t){const n=pageCache.get(e);t.innerHTML=n.content,updateAllMetaTags(n),announcePageLoad(n.title)}async function fetchAndRenderPage(e,t){showSkeleton(e,t);try{const n=await fetch(`/${e}.html`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=parsePageFragment(await n.text(),e);pageCache.set(e,o),t.innerHTML=o.content,updateAllMetaTags(o),announcePageLoad(o.title)}catch(e){console.error("Error al cargar la página:",e);404===parseInt(e.message.split(": ")[1],10)?(document.title="Error 404 - Página no encontrada",displayError(t,"🤔 Página no encontrada (Error 404)","La página que buscas no existe o ha sido movida.")):(document.title="Error de conexión",displayError(t,"🔌 Error de Conexión","No se pudo cargar la página. Por favor, comprueba tu conexión a internet."))}}function showSkeleton(e,t){const n={experiencia:SKELETONS.default,habilidades:SKELETONS.twoColumns,formacion:SKELETONS.twoColumns,"otros-datos":SKELETONS.threeColumns,contacto:SKELETONS.contact};t.innerHTML=n[e]||SKELETONS.default}function parsePageFragment(e,t){const n=(new DOMParser).parseFromString(e,"text/html");return{content:n.querySelector("section")?.outerHTML||n.body.innerHTML,title:n.querySelector("title")?.textContent||"Pedro Úbeda Sánchez",description:n.querySelector('meta[name="description"]')?.getAttribute("content")||"",canonical:n.querySelector('link[rel="canonical"]')?.getAttribute("href")||`https://pedroubedasanchez.es/${t}`,og:{title:n.querySelector('meta[property="og:title"]')?.getAttribute("content"),description:n.querySelector('meta[property="og:description"]')?.getAttribute("content"),url:n.querySelector('meta[property="og:url"]')?.getAttribute("content"),twitterTitle:n.querySelector('meta[name="twitter:title"]')?.getAttribute("content"),twitterDescription:n.querySelector('meta[name="twitter:description"]')?.getAttribute("content")}}}function getNavIndexForPath(e){const t=document.querySelector(`.nav-link[href="${e}"], .nav-link-mobile[href="${e}"]`);return t&&t.dataset.navIndex?parseInt(t.dataset.navIndex,10):0}function announcePageLoad(e){const t=document.getElementById("a11y-announcer");t&&(t.textContent=`Se ha cargado la página: ${e}.`)}function updateAllMetaTags({title:e,description:t,canonical:n,og:o}){document.title=e,updateMetaTag('meta[name="description"]',"content",t),updateMetaTag('link[rel="canonical"]',"href",n,!0),updateMetaTag('meta[property="og:title"]',"content",o.title||e),updateMetaTag('meta[property="og:description"]',"content",o.description||t),updateMetaTag('meta[property="og:url"]',"content",o.url||n),updateMetaTag('meta[name="twitter:title"]',"content",o.twitterTitle||o.title||e),updateMetaTag('meta[name="twitter:description"]',"content",o.twitterDescription||o.description||t)}function postNavigationTasks(e,t,n){window.scrollTo(0,0),setActiveNavLink(),currentNavIndex=getNavIndexForPath(e),initializePageScripts(t,n);const o=n.querySelector("h1");o&&(o.setAttribute("tabindex","-1"),o.focus(),o.addEventListener("blur",()=>o.removeAttribute("tabindex"),{once:!0})),window.dataLayer&&window.dataLayer.push({event:"page_view",page_path:e,page_title:document.title})}function initializePageScripts(e,t){setupScrollAnimations(),"sobre-mi"===e&&setupDirectPrint(),"contacto"===e&&(setupFormValidation(),setupPhoneObfuscation("phone-contact","phone-text-contact"))}function initializeRouter(){document.addEventListener("click",e=>{const t=e.target.closest("a");if(!t||!t.href)return;const n=t.getAttribute("href");if("_blank"===t.target||"noopener noreferrer"===t.rel||t.hasAttribute("download")||n?.startsWith("mailto:")||n?.includes("/cdn-cgi/l/email-protection"))return;const o=new URL(t.href);if(o.origin===window.location.origin){if(o.pathname.endsWith("/curriculum.html"))return;e.preventDefault(),window.location.pathname!==o.pathname&&history.pushState({},"",o.pathname),loadPageContent(o.pathname)}}),window.addEventListener("popstate",()=>{loadPageContent(window.location.pathname)})}async function main(){if(!document.querySelector("#main-content"))return void(document.body.style.opacity="1");const e=document.querySelector("#main-content");e&&(initialContent=e.innerHTML);const t=Promise.all([loadComponent("#header","/header.html"),loadComponent("#footer","/footer.html")]);await t,initializeMobileMenu(),initializeDarkMode(),setupSkipLink(),setupBackToTopButton(),initializeRouter(),await loadPageContent(window.location.pathname),document.body.style.opacity="1"}document.addEventListener("DOMContentLoaded",main),window.addEventListener("load",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>console.log("Service Worker registrado con éxito:",e)).catch(e=>console.log("Error en el registro del Service Worker:",e))});