function initializeMobileMenu(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu-close-button"),n=document.getElementById("mobile-menu-overlay");if(!e||!t||!n)return;const o=n.querySelectorAll("a[href], button"),i=o[0],a=o[o.length-1],r=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===i&&(a.focus(),e.preventDefault()):document.activeElement===a&&(i.focus(),e.preventDefault()))},c=()=>{n.classList.add("hidden"),n.setAttribute("aria-hidden","true"),document.body.style.overflow="",e.focus(),document.removeEventListener("keydown",r)};e.addEventListener("click",()=>{n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",t.focus(),document.addEventListener("keydown",r)}),t.addEventListener("click",c),n.querySelectorAll(".nav-link-mobile").forEach(e=>{e.addEventListener("click",c)}),document.addEventListener("keydown",e=>{"Escape"!==e.key||n.classList.contains("hidden")||c()})}function setupSkipLink(){const e=document.querySelector('a[href="#main-content"]'),t=document.getElementById("main-content");e&&t&&e.addEventListener("click",e=>{e.preventDefault(),t.setAttribute("tabindex","-1"),t.focus(),t.addEventListener("blur",()=>{t.removeAttribute("tabindex")},{once:!0})})}function setupPhoneObfuscation(e,t,n=""){const o=document.getElementById(e),i=document.getElementById(t);if(!o||!i)return;const a=atob("KzM0IDYzNSA5NDUgNzc5");o.addEventListener("click",function e(t){t.preventDefault(),i.textContent=`${n}${a}`.trim(),o.href=`tel:${a.replace(/\s/g,"")}`,o.removeEventListener("click",e)})}function setupPrintButton(){const e=document.getElementById("print-button");if(!e)return;e.addEventListener("click",()=>window.print());const t=document.createElement("button");t.id="home-button",t.className="bg-slate-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors duration-300 shadow-lg transform hover:scale-105 ml-4",t.innerHTML="🏠 Volver a la página principal",t.addEventListener("click",()=>window.location.href="/"),e.insertAdjacentElement("afterend",t)}function setupScrollAnimations(){const e=document.querySelectorAll(".animate-on-scroll");if(!e.length)return;const t=new IntersectionObserver((e,t)=>{e.forEach((e,n)=>{e.isIntersecting&&(setTimeout(()=>{e.target.classList.add("is-visible")},100*n),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{t.observe(e)})}function setupFormValidation(){const e=document.querySelector('form[action*="formsubmit.co"]');if(!e)return;const t=e.querySelectorAll("input[required], textarea[required]"),n=e.querySelector('button[type="submit"]'),o=document.getElementById("form-general-error"),i=n?n.innerHTML:"",a=(e,t)=>{const n=document.getElementById(`${e.id}-error`);n&&(n.textContent=t),e.setAttribute("aria-invalid","true"),e.classList.add("input-error")},r=e=>e.validity.valueMissing?(a(e,"Este campo es obligatorio."),!1):e.validity.typeMismatch&&"email"===e.type?(a(e,"Por favor, introduce una dirección de correo válida."),!1):((e=>{const t=document.getElementById(`${e.id}-error`);t&&(t.textContent=""),e.setAttribute("aria-invalid","false"),e.classList.remove("input-error")})(e),!0);e.addEventListener("submit",function(a){a.preventDefault(),n&&(n.disabled=!0,n.innerHTML="Enviando..."),o&&(o.textContent="");let c=!0;if(t.forEach(e=>{r(e)||(c=!1)}),!c)return console.log("Formulario no válido. No se enviará."),void(n&&(n.disabled=!1,n.innerHTML=i));grecaptcha.ready(function(){grecaptcha.execute("6LcfUs8rAAAAAErA7-oGbid2aiEL8_iBy7jZ-WYl",{action:"submit"}).then(function(t){console.log("Token de reCAPTCHA generado:",t),document.getElementById("recaptcha-response").value=t,e.submit()}).catch(function(e){console.error("Error de reCAPTCHA:",e),o&&(o.textContent="No se pudo verificar el reCAPTCHA. Por favor, inténtalo de nuevo."),n&&(n.disabled=!1,n.innerHTML=i)})})}),t.forEach(e=>{e.addEventListener("blur",e=>r(e.target)),e.addEventListener("input",e=>{"true"===e.target.getAttribute("aria-invalid")&&r(e.target)})})}function setupBackToTopButton(){const e=document.getElementById("back-to-top");e&&(window.addEventListener("scroll",()=>{window.scrollY>300?e.classList.add("is-visible"):e.classList.remove("is-visible")}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}async function loadComponent(e,t){try{const n=await fetch(t);if(!n.ok)throw new Error(`Error al cargar ${t}: ${n.statusText}`);const o=await n.text(),i=document.querySelector(e);i&&(i.innerHTML=o)}catch(e){console.error(`No se pudo cargar el componente desde ${t}:`,e)}}function setActiveNavLink(){const e=window.location.pathname;document.querySelectorAll(".nav-link, .nav-link-mobile").forEach(t=>{new URL(t.href).pathname===e?t.setAttribute("aria-current","page"):t.removeAttribute("aria-current")})}!function(){const e=window.location;if(e.search){const t={};if(e.search.slice(1).split("&").forEach(function(e){const n=e.split("=");t[n[0]]=decodeURIComponent(n[1]).replace(/~and~/g,"&")}),t.p){const n=e.pathname.split("/").slice(0,-1).join("/")+t.p;window.history.replaceState(null,null,n+(t.q?"?"+t.q:"")+e.hash)}}}();const pageCache=new Map;let initialContent=null;async function loadPageContent(e){if(!document.getElementById("main-content"))return;const t=document.getElementById("main-content");t.style.opacity="0",await new Promise(e=>setTimeout(e,300)),initialContent||(initialContent=t.innerHTML);const n="/"===e?"sobre-mi":e.substring(1);if("sobre-mi"===n)t.innerHTML=initialContent,document.title="Pedro Úbeda Sánchez | Técnico en Informática, Aviónica y Administración",updateMetaTags("description","Sitio web profesional de Pedro Úbeda Sánchez, técnico especialista con más de 20 años de experiencia en informática, aviónica y administración. Descubre mi trayectoria y habilidades."),updateMetaTags("canonical","https://pedroubedasanchez.es/");else if(pageCache.has(n)){const{content:e,title:o,description:i,canonical:a}=pageCache.get(n);t.innerHTML=e,document.title=o,updateMetaTags("description",i),updateMetaTags("canonical",a)}else{t.innerHTML='<div class="text-center p-12">Cargando...</div>';try{const e=await fetch(`${n}.html`);if(!e.ok)throw new Error(`Página no encontrada: ${n}.html`);const o=await e.text(),i=(new DOMParser).parseFromString(o,"text/html"),a=i.querySelector("section"),r=a?a.outerHTML:'<div class="text-center p-12">Error: No se encontró contenido en la página cargada.</div>',c=i.querySelector("title")?.textContent||"Pedro Úbeda Sánchez",s=i.querySelector('meta[name="description"]')?.getAttribute("content")||"",l=i.querySelector('link[rel="canonical"]')?.getAttribute("href")||`https://pedroubedasanchez.es/${n}`;pageCache.set(n,{content:r,title:c,description:s,canonical:l}),t.innerHTML=r,document.title=c,updateMetaTags("description",s),updateMetaTags("canonical",l)}catch(e){console.error(e),t.innerHTML='<div class="text-center p-12">Error al cargar el contenido.</div>',document.title="Error - Página no encontrada"}}window.scrollTo(0,0),setActiveNavLink(),initializePageScripts(n),t.style.opacity="1"}function updateMetaTags(e,t){let n;"description"===e?n=document.querySelector('meta[name="description"]'):"canonical"===e&&(n=document.querySelector('link[rel="canonical"]')),n&&n.setAttribute("canonical"===e?"href":"content",t)}function initializePageScripts(e){setupScrollAnimations(),"contacto"===e&&(setupFormValidation(),setupPhoneObfuscation("phone-contact","phone-text-contact")),document.body.querySelector("#print-button")&&(setupPrintButton(),setupPhoneObfuscation("phone-cv","phone-text-cv","📞 "))}function initializeRouter(){document.addEventListener("click",e=>{const t=e.target.closest("a");if(!t||"_blank"===t.target||t.hasAttribute("download")||t.href.includes("mailto:"))return;const n=new URL(t.href);if(n.origin===window.location.origin){if(n.pathname.endsWith("curriculum.html"))return;e.preventDefault(),history.pushState({},"",n.pathname),loadPageContent(n.pathname)}}),window.addEventListener("popstate",()=>loadPageContent(window.location.pathname)),loadPageContent(window.location.pathname)}document.addEventListener("DOMContentLoaded",()=>{document.body.style.opacity="1",document.getElementById("main-content")&&(initializeRouter(),Promise.all([loadComponent("#header","header.html"),loadComponent("#footer","footer.html")]).then(()=>{initializeMobileMenu(),setActiveNavLink()}),setupSkipLink(),setupBackToTopButton()),initializePageScripts(window.location.pathname.substring(1).replace(".html",""))});