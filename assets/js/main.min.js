function initializeMobileMenu(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu-close-button"),n=document.getElementById("mobile-menu-overlay");if(!e||!t||!n)return;const o=n.querySelectorAll("a[href], button"),i=o[0],a=o[o.length-1],r=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===i&&(a.focus(),e.preventDefault()):document.activeElement===a&&(i.focus(),e.preventDefault()))},c=()=>{n.classList.add("hidden"),n.setAttribute("aria-hidden","true"),document.body.style.overflow="",e.focus(),document.removeEventListener("keydown",r)};e.addEventListener("click",()=>{n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",t.focus(),document.addEventListener("keydown",r)}),t.addEventListener("click",c),n.querySelectorAll(".nav-link-mobile").forEach(e=>{e.addEventListener("click",c)}),document.addEventListener("keydown",e=>{"Escape"!==e.key||n.classList.contains("hidden")||c()})}function setupSkipLink(){const e=document.querySelector('a[href="#main-content"]'),t=document.getElementById("main-content");e&&t&&e.addEventListener("click",e=>{e.preventDefault(),t.setAttribute("tabindex","-1"),t.focus(),t.addEventListener("blur",()=>{t.removeAttribute("tabindex")},{once:!0})})}function setupPhoneObfuscation(e,t,n=""){const o=document.getElementById(e),i=document.getElementById(t);if(!o||!i)return;const a=atob("KzM0IDYzNSA5NDUgNzc5");o.addEventListener("click",function e(t){t.preventDefault(),i.textContent=`${n}${a}`.trim(),o.href=`tel:${a.replace(/\s/g,"")}`,o.removeEventListener("click",e)})}function setupBackToTopButton(){const e=document.getElementById("back-to-top");e&&(window.addEventListener("scroll",()=>{window.scrollY>300?e.classList.add("is-visible"):e.classList.remove("is-visible")}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function setupScrollAnimations(){const e=document.querySelectorAll(".animate-on-scroll");if(!e.length)return;const t=new IntersectionObserver((e,t)=>{e.forEach((e,n)=>{e.isIntersecting&&(setTimeout(()=>{e.target.classList.add("is-visible")},100*n),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{t.observe(e)})}function setupFormValidation(){const e=document.getElementById("contact-form");if(!e)return;const t=e.querySelectorAll("input[required], textarea[required]"),n=e.querySelector('button[type="submit"]'),o=document.getElementById("form-general-error"),i=n.querySelector(".button-text"),a=n.querySelector(".button-spinner"),r=(e,t)=>{const n=document.getElementById(`${e.id}-error`);n&&(n.textContent=t,n.classList.add("form-error-active")),e.setAttribute("aria-invalid","true"),e.classList.add("input-error")},c=e=>{const t=document.getElementById(`${e.id}-error`);t&&(t.textContent="",t.classList.remove("form-error-active")),e.setAttribute("aria-invalid","false"),e.classList.remove("input-error")},s=e=>e.validity.valueMissing?(r(e,"Este campo es obligatorio."),!1):e.validity.typeMismatch&&"email"===e.type?(r(e,"Por favor, introduce una direcci칩n de correo v치lida."),!1):(c(e),!0),d=(document.getElementById("contact-form-wrapper"),document.getElementById("form-success-message"));e.addEventListener("submit",async r=>{r.preventDefault(),n.disabled=!0,i&&i.classList.add("hidden"),a&&a.classList.remove("hidden"),o&&(o.textContent="");let c=!0;if(t.forEach(e=>{s(e)||(c=!1)}),!c)return console.log("Formulario no v치lido. No se enviar치."),n.disabled=!1,i&&i.classList.remove("hidden"),void(a&&a.classList.add("hidden"));try{const t=await grecaptcha.execute("6LcfUs8rAAAAAErA7-oGbid2aiEL8_iBy7jZ-WYl",{action:"submit"});document.getElementById("recaptcha-response").value=t;const n=new FormData(e),o=Object.fromEntries(n.entries()),i=o._formsubmit_endpoint;delete o._formsubmit_endpoint;const a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)});if(!a.ok){const e=await a.json();throw new Error(e.message||"Hubo un problema al enviar el formulario.")}e.classList.add("hidden"),d.classList.remove("hidden")}catch(e){console.error("Error en el env칤o del formulario:",e),o&&(o.textContent="Error: "+e.message+" Por favor, int칠ntalo de nuevo m치s tarde.")}finally{i&&i.classList.remove("hidden"),a&&a.classList.add("hidden"),d.classList.contains("hidden")&&(n.disabled=!1)}}),t.forEach(e=>{e.addEventListener("blur",e=>s(e.target)),e.addEventListener("input",e=>{(e.target.validity.typeMismatch||e.target.classList.contains("input-error"))&&s(e.target)})});const l=document.getElementById("form-reset-button");l&&l.addEventListener("click",()=>{d.classList.add("hidden"),e.reset(),t.forEach(c),o&&(o.textContent=""),e.classList.remove("hidden"),n.disabled=!1,i&&i.classList.remove("hidden"),a&&a.classList.add("hidden")})}function setActiveNavLink(){const e=window.location.pathname;document.querySelectorAll("a.nav-link, a.nav-link-mobile").forEach(t=>{new URL(t.href).pathname===e?t.setAttribute("aria-current","page"):t.removeAttribute("aria-current")})}!function(){const e=window.location;if(e.search){const t={};if(e.search.slice(1).split("&").forEach(e=>{const n=e.split("=");t[n[0]]=decodeURIComponent(n[1]).replace(/~and~/g,"&")}),t.p){const n=e.pathname.replace(/\/$/,"")+t.p;window.history.replaceState(null,null,n+(t.q?"?"+t.q:"")+e.hash)}}}();const pageCache=new Map;let initialContent=null;function setupDirectPrint(){const e=document.getElementById("print-cv-button");e&&e.addEventListener("click",e=>{e.preventDefault();const t=window.open("/curriculum.html","_blank");t.onload=()=>t.print()})}async function loadComponent(e,t){try{const n=await fetch(t);if(!n.ok)throw new Error(`Error al cargar ${t}: ${n.statusText}`);const o=await n.text(),i=document.querySelector(e);i&&(i.innerHTML=o)}catch(e){console.error(`No se pudo cargar el componente desde ${t}:`,e)}}function updateMetaTag(e,t,n,o=!1){if("string"!=typeof n||""===n.trim())return;let i=document.querySelector(e);i||(i=document.createElement(o?"link":"meta"),e.match(/\[(.*?)\]/g).forEach(e=>{const[t,n]=e.slice(1,-1).split("=");i.setAttribute(t,n.replace(/"/g,""))}),document.head.appendChild(i)),i.setAttribute(t,n)}function displayError(e,t,n){e.innerHTML=`\n        <section class="text-center bg-white py-16 px-4 sm:px-8 rounded-lg shadow-lg">\n            <h1 class="text-3xl sm:text-4xl font-bold mb-4 text-red-600">${t}</h1>\n            <p class="text-slate-600 mb-8 max-w-lg mx-auto">${n}</p>\n            <a class="inline-block bg-orange-700 text-white font-bold py-3 px-6 rounded-lg hover:bg-orange-800 transition-colors duration-300 shadow-lg" href="/">\n                Volver a la p치gina principal\n            </a>\n        </section>\n    `}async function loadPageContent(e){if(!document.getElementById("main-content"))return;const t=document.getElementById("main-content"),n=async()=>{const n="/"===e||"/index.html"===e||""===e?"sobre-mi":e.substring(1).replace(/\.html$/,"");if("sobre-mi"===n)t.innerHTML=initialContent,document.title="Pedro 칔beda S치nchez | T칠cnico en Inform치tica, Avi칩nica y Administraci칩n",updateMetaTag('meta[name="description"]',"content","Sitio web profesional de Pedro 칔beda S치nchez, t칠cnico especialista con m치s de 20 a침os de experiencia en inform치tica, avi칩nica y administraci칩n. Descubre mi trayectoria y habilidades."),updateMetaTag('link[rel="canonical"]',"href","https://pedroubedasanchez.es/",!0),updateMetaTag('meta[property="og:title"]',"content","Pedro 칔beda S치nchez | T칠cnico Especialista"),updateMetaTag('meta[property="og:description"]',"content","T칠cnico con m치s de 20 a침os de experiencia en inform치tica, avi칩nica y administraci칩n."),updateMetaTag('meta[property="og:url"]',"content","https://pedroubedasanchez.es/"),updateMetaTag('meta[name="twitter:title"]',"content","Pedro 칔beda S치nchez | T칠cnico Especialista"),updateMetaTag('meta[name="twitter:description"]',"content","T칠cnico con m치s de 20 a침os de experiencia en inform치tica, avi칩nica y administraci칩n.");else if(pageCache.has(n)){const{content:e,title:o,description:i,canonical:a,og:r}=pageCache.get(n);t.innerHTML=e,document.title=o,updateMetaTag('meta[name="description"]',"content",i),updateMetaTag('link[rel="canonical"]',"href",a,!0),updateMetaTag('meta[property="og:title"]',"content",r.title||o),updateMetaTag('meta[property="og:description"]',"content",r.description||i),updateMetaTag('meta[property="og:url"]',"content",r.url||a),updateMetaTag('meta[name="twitter:title"]',"content",r.twitterTitle||o),updateMetaTag('meta[name="twitter:description"]',"content",r.twitterDescription||i)}else{t.innerHTML='<div class="flex justify-center items-center py-24"><div class="loader" role="status" aria-label="Cargando contenido"></div></div>';try{const e=await fetch(`/${n}.html`);if(!e.ok){if(404!==e.status)throw new Error(`Error HTTP: ${e.status}`);return document.title="Error 404 - P치gina no encontrada",void displayError(t,"游뱂 P치gina no encontrada (Error 404)","La p치gina que buscas no existe o ha sido movida. Por favor, comprueba la URL o vuelve al inicio.")}const o=await e.text(),i=(new DOMParser).parseFromString(o,"text/html"),a=i.querySelector("section")?.outerHTML||i.body.innerHTML,r=i.querySelector("title")?.textContent||"Pedro 칔beda S치nchez",c=i.querySelector('meta[name="description"]')?.getAttribute("content")||"",s=i.querySelector('link[rel="canonical"]')?.getAttribute("href")||`https://pedroubedasanchez.es/${n}`,d={title:i.querySelector('meta[property="og:title"]')?.getAttribute("content"),description:i.querySelector('meta[property="og:description"]')?.getAttribute("content"),url:i.querySelector('meta[property="og:url"]')?.getAttribute("content"),twitterTitle:i.querySelector('meta[name="twitter:title"]')?.getAttribute("content"),twitterDescription:i.querySelector('meta[name="twitter:description"]')?.getAttribute("content")};pageCache.set(n,{content:a,title:r,description:c,canonical:s,og:d}),t.innerHTML=a,document.title=r,updateMetaTag('meta[name="description"]',"content",c),updateMetaTag('link[rel="canonical"]',"href",s,!0),updateMetaTag('meta[property="og:title"]',"content",d.title||r),updateMetaTag('meta[property="og:description"]',"content",d.description||c),updateMetaTag('meta[property="og:url"]',"content",d.url||s),updateMetaTag('meta[name="twitter:title"]',"content",d.twitterTitle||r),updateMetaTag('meta[name="twitter:description"]',"content",d.twitterDescription||c)}catch(e){console.error("Error de red al cargar la p치gina:",e),document.title="Error de conexi칩n",displayError(t,"游댋 Error de Conexi칩n","No se pudo cargar la p치gina. Por favor, comprueba tu conexi칩n a internet e int칠ntalo de nuevo.")}}window.scrollTo(0,0),setActiveNavLink(),initializePageScripts(n,t);const o=t.querySelector("h1");o&&(o.setAttribute("tabindex","-1"),o.focus()),window.dataLayer&&window.dataLayer.push({event:"page_view",page_path:e,page_title:document.title})};document.startViewTransition?document.startViewTransition(n):await n()}function initializePageScripts(e,t){setupScrollAnimations(),"sobre-mi"===e&&setupDirectPrint(),"contacto"===e&&(setupFormValidation(),setupPhoneObfuscation("phone-contact","phone-text-contact"))}function initializeRouter(){document.addEventListener("click",e=>{const t=e.target.closest("a");if(!t)return;const n=t.getAttribute("href");"_blank"===t.target||t.rel;if(!t||"_blank"===t.target||t.hasAttribute("download")||n?.startsWith("mailto:")||n?.includes("/cdn-cgi/l/email-protection"))return;const o=new URL(t.href);if(o.origin===window.location.origin){if(o.pathname.endsWith("/curriculum.html"))return;e.preventDefault(),window.location.pathname!==o.pathname&&history.pushState({},"",o.pathname),loadPageContent(o.pathname)}}),window.addEventListener("popstate",()=>{loadPageContent(window.location.pathname)})}async function main(){if(!document.getElementById("main-content"))return void(document.body.style.opacity="1");const e=document.getElementById("main-content");e&&(initialContent=e.innerHTML),await Promise.all([loadComponent("#header","/header.html"),loadComponent("#footer","/footer.html")]),initializeMobileMenu(),setupSkipLink(),setupBackToTopButton(),initializeRouter(),loadPageContent(window.location.pathname),document.body.style.opacity="1"}document.addEventListener("DOMContentLoaded",main),window.addEventListener("load",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>console.log("Service Worker registrado con 칠xito:",e)).catch(e=>console.log("Error en el registro del Service Worker:",e))});